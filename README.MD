# Chopsticks Calibration System
### 젓가락 교정 시스템

OpenPose를 이용한 젓가락질 교정 시스템입니다.

이미지를 입력받고, 입력받은 이미지에서 OpenPose를 이용하여 손가락의 관절을 검출합니다.

검출된 손가락과, 올바른 젓가락질을 비교하여 얼마나 잘못되었는지를 예측합니다.

예측한 결과를 OpenCV를 이용하여 이미지에서 잘못된 부분을 어떻게 옮겨서 올바른 젓가락질을 하는지에 대해서 알 수 있도록 시각화해서 나타냅니다.

손의 관절만이 아니라 젓가락의 위치에서도 중요한 점을 파악하여 젓가락을 어떻게 잡고 있는지 등을 추측하여 잘못된 부분을 파악해서 사용자에게 알려줍니다.

---------------------------------------------------------------------------------------------------------------------------------------------------------------

## 개요

휴대폰 어플로 이미지를 촬영한 뒤, 촬영된 이미지가 Flask DB서버로 전송된다.

전송된 이미지를 이용하여 OpenPose Model을 사용하여 손의 관절(키포인트)을 검출한다.

이후 그 키포인트와 올바른 키포인트를 비교하여 어떤 키포인트가, 얼마나 잘못되었는지를 찾아냄으로써 자신의 젓가락질에 있어서 잘못된 부위를 찾고 정확도를 알아낼 수 있다.

잘못된 부위를 사람이 알아볼 수 있게 시각화해서 표시하고, 어떻게 수정해야 하는지에 대한 가이드를 제시한다.

<img src="https://user-images.githubusercontent.com/66740126/131482402-c08603dc-c8ad-42cd-81de-857d79f3f511.png">



## 1. 이미지 입력 및 관절 검출

손이 나오는 이미지에서 손의 형태를 추정할 수 있어야 한다.

손의 형태를 추정하는 기술에는 3D Depth Camer로 촬영한 이미지와, 일반적인 2D Camer에서 촬영한 이미지가 있다.

3D 이미지는 일반적인 이미지에서 겹쳐지는 상황에서 보기 어려운 부분에서도 손의 형태를 추정할 수 있다는 장점이 있으나, 일반적인 카메라가 아닌 별도의 카메라가 필요하고 이로 인해서 촬영된 이미지에서 정상적인 자세 추정이 힘들기 때문에 2D이미지에서 사람이 특정 각도를 통해서 촬영할 수 있도록 하는 것을 목표로 해서 구현한다.

2D 이미지에서는 입력받은 이미지를 OpenPose를 이용해서 관절을 검출하고, 이를 통해서 손의 자세를 추정한다.


<p align="center"><img src="https://user-images.githubusercontent.com/66740126/131484778-442f0553-3faa-40c5-9102-2befa2dead4e.png"></p>



## 2. 입력된 이미지와 올바른 젓가락질 비교

이미지에서 관절별로 키포인트 생성이 되는 것을 확인하고, 각 손가락이 꺾여있는 정도를 각도를 통해서 판별한다. 

올바른 젓가락질에서의 각도와, 입력된 이미지에서의 각도를 계산하고 비교하여 각 키포인트별로 각도가 얼마나 다른지를 찾아서 각도의 차이가 큰 키포인트를 잘못된 키포인트로 판단하고 사용자의 젓가락질에서 잘못된 부분이라고 판단하고, 정확도를 계산할 수 있다.


![2각도](https://user-images.githubusercontent.com/66740126/131485301-44894595-654c-4156-9f86-167b01ae8125.png)


이 과정에서, 올바른 젓가락질이라고 판단하는데 있어서 중요한 손가락과 중요하지 않은 손가락이 구분된다고 판단되었기 때문에 엄지와 소지는 중요하지 않은 키포인트라고 판단하여 올바른 젓가락질과 비교할 때 제외하고 검지, 중지, 약지 3가지 손가락을 위주로 하여서 비교하기로 한다.


![4비교](https://user-images.githubusercontent.com/66740126/131485442-4804158a-b330-434f-9c62-35b589f8d629.png)


이 과정에서 사용자의 젓가락질이 비교한 젓가락질과 각도 차이가 큰 부분을 빨갛게 표시가 되고, 초록색으로 손의 관절이 향해야 하는 올바른 방향을 알려준다.


## 3. 직선 검출

젓가락질이 올바른가를 판별하는데 있어서 손의 형태도 중요하지만 젓가락이 어느 위치에 있는지, 어떻게 쥐고 있는지도 중요한 요소 중 하나이다.

따라서, 이미지에서 직선을 검출하기 위해 Canny Edge Detection을 이용하여 외곽선을 검출한 뒤, Hough Transform을 수행하여 선명한 직선을 찾아서 검출한다.

Canny Edge Detection으로 명확한 직선의 형태를 검출하기 위해 여러 파라미터를 적용시켜 보면서 가장 이상적인 형태를 찾을 수 있도록 한다.


#### 3-1 Canny Edge Detection


![5캐니엣지](https://user-images.githubusercontent.com/66740126/131492564-accfb3c6-55cb-4c63-af63-b42e7677099c.png)


#### 3-2 Hough Transformation


![6허프변환](https://user-images.githubusercontent.com/66740126/131492585-de76d869-58bb-4c29-a424-71703110e936.png)


검출된 직선을 이용하여 젓가락의 위치와 형태, 어떻게 쥐고 있는지를 추정할 수 있다.



## 4. 모바일에서의 동작

모바일에서 작동시키기 위해 Flask DB를 클라우드 DB로 사용하고 Android 10.0(API 29)을 사용하여 어플리케이션을 개발한다.

이미지를 어플리케이션으로 촬영하고, 클라우드 DB로 전송한 뒤 프로그램에서 이미지를 입력받아 프로그램을 실행한 뒤 키포인트가 그려진 이미지를 어플리케이션을 통해서 모바일 화면상에 출력시키도록 한다.


![7 알고리즘2](https://user-images.githubusercontent.com/66740126/131493235-5bd5299b-8b05-4eac-afc1-94a4707e94f5.png)


모바일에서 실행 시

시작화면

<img width="150" height="300" src="https://user-images.githubusercontent.com/66740126/131493976-2eba0a04-d922-4a37-b06d-9dece7455ebf.jpg">


메뉴 선택화면


<img width="150" height="300" src="https://user-images.githubusercontent.com/66740126/131493964-b8992f47-5d49-445c-8c53-b20489a0b4c9.jpg">


튜토리얼 선택 시, 어플을 어떻게 사용해야 하는지에 대해서 알려줍니다.


<img width="150" height="300" src="https://user-images.githubusercontent.com/66740126/131493997-4d7493ec-f1d4-438b-9d64-b86bcc71940f.jpg">


이미지 입력


<img width="150" height="300" src="https://user-images.githubusercontent.com/66740126/131493276-57489e90-4ccf-4a53-a613-90022de6ca8d.jpg">


이미지가 입력되고 결과를 보여준다.


<img width="150" height="300" src="https://user-images.githubusercontent.com/66740126/131494007-0e3cb8fa-9033-4460-ab12-b7b412c0e13b.jpg">



## 5. 동작 시연




---------------------------------------------------------------------------------------------------------------------------------------------------------------

OpenPose link : https://github.com/CMU-Perceptual-Computing-Lab/openpose

창원대학교 졸업작품 - 권용진, 이정현
